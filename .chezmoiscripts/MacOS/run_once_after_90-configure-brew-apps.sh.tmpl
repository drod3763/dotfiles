{{- if (eq .chezmoi.os "darwin") -}}
#!/bin/bash

set -eufo pipefail

{{ if and (stat "/Applications/iTerm.app") 
(and 
(not (stat (expandenv "$HOME/.iterm2_shell_integration.zsh")))  
(not (stat (expandenv "$HOME/.iterm2_shell_integration.bash")))) -}}
# iTerm2 Shell Integration
curl -L https://iterm2.com/shell_integration/install_shell_integration_and_utilities.sh | bash
{{ end -}}

{{ if lookPath "op" -}}
# Initialize 1pass cli
eval $(op signin) || eval $(op signin my.1password.com {{ .onepassuser }})
{{ end -}}

{{ if lookPath "gh" -}}
# Initialize github cli
gh auth status || gh auth login
{{ end -}}

{{ if lookPath "tldr" -}}
# Update tldr db
tldr --update
{{ end -}}

{{ if lookPath "yubikey-agent" -}}
# Initialize yubikey-agent
brew services start yubikey-agent
{{ end -}}

{{ if not .personal -}}
# Install tilt for aws
curl -fsSL https://raw.githubusercontent.com/tilt-dev/tilt/master/scripts/install.sh | bash
{{ end -}}

{{- end -}}